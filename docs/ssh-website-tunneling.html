
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Protect websites with the power of SSH &#8212; IARP 1.0.0 documentation</title>
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Git, committed and pushed to the incorrect branch" href="git-commit-push-wrong-branch.html" />
    <link rel="prev" title="Dealing with larger SQL datasets and limited memory" href="sql-dataset-memory.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="git-commit-push-wrong-branch.html" title="Git, committed and pushed to the incorrect branch"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sql-dataset-memory.html" title="Dealing with larger SQL datasets and limited memory"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">IARP 1.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Protect websites with the power of SSH</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="protect-websites-with-the-power-of-ssh">
<h1>Protect websites with the power of SSH<a class="headerlink" href="#protect-websites-with-the-power-of-ssh" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>Originally Written: 2015-05-17</p>
</div></blockquote>
<p>This only works on systems that you have control of. If you’re on a shared hosting system this is not for you.</p>
<p>The basis of this trick is based on using PuTTY, an SSH connection, and a proxy application to tunnel your
browsers internet connection through the web server.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>SSH access to the web server</p></li>
<li><p><a class="reference external" href="http://www.chiark.greenend.org.uk/~sgtatham/putty/">PuTTY</a> (any other application that has SSH tunneling would also work)</p></li>
<li><p><a class="reference external" href="https://chrome.google.com/webstore/detail/proxy-switchysharp/dpplabbmogkhghncfbfdeeokoefdjegm">Proxy SwitchySharp for Google Chrome</a></p></li>
<li><p><a class="reference external" href="https://addons.mozilla.org/en-US/firefox/addon/proxy-selector/">Proxy Selector for Firefox</a></p></li>
</ul>
</div>
<div class="section" id="putty-setup">
<h2>PuTTY Setup<a class="headerlink" href="#putty-setup" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Connect to your web server via SSH</strong> using PuTTY</p></li>
<li><p><strong>Right click along the top title bar</strong> of the PuTTY window</p></li>
<li><p>Select <strong>Change Settings</strong></p></li>
<li><p>Along the left sidebar of items <strong>go to Connection -&gt; SSH -&gt; Tunnels</strong></p></li>
<li><p>In <strong>Source port</strong> enter <strong>8081</strong> or any port number of your choosing.</p>
<ul>
<li><p>VLC, Skype, and other various applications commonly use 8080 and it may cause conflicts when trying to bind.</p></li>
</ul>
</li>
<li><p><strong>Leave Destination blank</strong></p></li>
<li><p>Select the <strong>Dynamic radio selector</strong></p></li>
<li><p>Leave the next row of <strong>radio selectors on Auto</strong></p></li>
<li><p><strong>Click Add</strong></p></li>
</ul>
</div>
<div class="section" id="browser-setup">
<h2>Browser Setup<a class="headerlink" href="#browser-setup" title="Permalink to this headline">¶</a></h2>
<div class="section" id="google-chrome">
<h3>Google Chrome<a class="headerlink" href="#google-chrome" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Ensure the Proxy Switchysharp extension or equivilent is installed</p></li>
<li><p>Within Google Chrome <strong>right click on the Proxy Switchysharp</strong> icon in the top right corner and select <strong>Options</strong></p></li>
<li><p>Make sure you are on the <strong>Proxy Profiles tab</strong></p></li>
<li><p>Select <strong>New Profile</strong></p>
<ul>
<li><p>Profile Name: 127.0.0.1:8081</p></li>
<li><p>Manual Configuration</p>
<ul>
<li><p>SOCKS Host: 127.0.0.1 Port 8081</p></li>
</ul>
</li>
<li><p>Save</p></li>
<li><p>Close</p></li>
</ul>
</li>
</ul>
<p>Back in Google Chrome, left click on the Proxy Switchysharp icon in the top right and select 127.0.0.1:8081.</p>
</div>
<div class="section" id="mozilla-firefox">
<h3>Mozilla Firefox<a class="headerlink" href="#mozilla-firefox" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Ensure the Proxy Selector add-on or equivilent is installed</p></li>
<li><p>Within Firefox click on the addon icon in the top right and select <strong>Manage Proxies</strong></p></li>
<li><p>Click <strong>Add</strong></p>
<ul>
<li><p>Proxy Label: 127.0.0.1:8081</p></li>
<li><p>Manual proxy configuration</p>
<ul>
<li><p>SOCKS Host: 127.0.0.1 Port 8081</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Click <strong>OK</strong></p></li>
</ul>
<p>Back in Firefox, click on the Proxy addon icon and select 127.0.0.1:8081.</p>
</div>
</div>
<div class="section" id="confirming-browser-setup">
<h2>Confirming Browser Setup<a class="headerlink" href="#confirming-browser-setup" title="Permalink to this headline">¶</a></h2>
<p>Once you have done that head over to <a class="reference external" href="http://whatismyip.org/">http://whatismyip.org/</a> and ensure that the IP address it returns is
the same as your web servers IP address.</p>
<ul class="simple">
<li><p>If the IP address is NOT the same as your web server, the proxy is not working.</p></li>
<li><p>If you get a message that you can no longer connect to the internet, go back into Proxy options and ensure you put
in the correct port number that you use during the PuTTY setup phase.</p></li>
</ul>
<p>If your IP address does match your web servers IP address, congratulations the proxy portion is complete.</p>
</div>
<div class="section" id="now-what">
<h2>Now What?<a class="headerlink" href="#now-what" title="Permalink to this headline">¶</a></h2>
<p>Well from here we need to edit your web server software to only allow connections from your web servers IP address.
That way, the only way to access the portion of your website under the proxy protection is via connecting to your web
server directly and accessing it through the proxy.</p>
<p>In the examples below I will go off the basis that 54.56.47.5 is my web servers IP address.</p>
<div class="section" id="apache">
<h3>Apache<a class="headerlink" href="#apache" title="Permalink to this headline">¶</a></h3>
<p>Apache is fairly straight forward, even a slight .htaccess modification would do.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Order</span> <span class="n">deny</span><span class="p">,</span><span class="n">allow</span>
<span class="n">Deny</span> <span class="kn">from</span> <span class="nn">all</span>
<span class="n">Allow</span> <span class="kn">from</span> <span class="mf">54.56</span><span class="o">.</span><span class="mf">47.5</span>
</pre></div>
</div>
<p>You can also protect a subfolder within a public folder. For example i want to protect a folder named admin in
the root of the main website</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;Directory /var/www/public_html/admin/&gt;
    RewriteEngine On
    RewriteCond %{REQUEST_URI} ^(.*)?administrator(.*)$
    RewriteCond %{REMOTE_ADDR} !^54\.56\.47\.5$
    RewriteCond %{HTTP:X-Forwarded-For} !^54\.56\.47\.5$
    RewriteRule ^(.*)$ - [R=403,L]
&lt;/Directory&gt;
</pre></div>
</div>
<p>Restart Apache and try to access the folder you have now protected. If you are still connected to the ssh server
with proxy on you should have access. If you go to the proxy addon and go back to System Proxy (or Direct Connection)
and attempt to view the same page, you should get a 403 denied error, or some type of error depending on server
configuration.</p>
<p>If you still have access to the page with the proxy turned off, something isn’t right with your apache configuration.
Have a look at the code above and look further into what changes you have made.</p>
</div>
</div>
<div class="section" id="wordpress-protection">
<h2>WordPress protection<a class="headerlink" href="#wordpress-protection" title="Permalink to this headline">¶</a></h2>
<p>This is the code required for Apache to protect a WordPress installation</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RewriteEngine on
RewriteCond %{REQUEST_URI} ^(.*)?wp-login\.php(.*)$ [OR]
RewriteCond %{REQUEST_URI} ^(.*)?wp-admin(.*)$
RewriteCond %{REMOTE_ADDR} !^54\.56\.47\.5$
RewriteCond %{HTTP:X-Forwarded-For} !^54\.56\.47\.5$
RewriteRule ^(.*)$ - [R=403,L]
</pre></div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Protect websites with the power of SSH</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#putty-setup">PuTTY Setup</a></li>
<li><a class="reference internal" href="#browser-setup">Browser Setup</a><ul>
<li><a class="reference internal" href="#google-chrome">Google Chrome</a></li>
<li><a class="reference internal" href="#mozilla-firefox">Mozilla Firefox</a></li>
</ul>
</li>
<li><a class="reference internal" href="#confirming-browser-setup">Confirming Browser Setup</a></li>
<li><a class="reference internal" href="#now-what">Now What?</a><ul>
<li><a class="reference internal" href="#apache">Apache</a></li>
</ul>
</li>
<li><a class="reference internal" href="#wordpress-protection">WordPress protection</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="sql-dataset-memory.html"
                        title="previous chapter">Dealing with larger SQL datasets and limited memory</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="git-commit-push-wrong-branch.html"
                        title="next chapter">Git, committed and pushed to the incorrect branch</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/ssh-website-tunneling.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="git-commit-push-wrong-branch.html" title="Git, committed and pushed to the incorrect branch"
             >next</a> |</li>
        <li class="right" >
          <a href="sql-dataset-memory.html" title="Dealing with larger SQL datasets and limited memory"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">IARP 1.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Protect websites with the power of SSH</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, IARP.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>